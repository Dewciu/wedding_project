{% extends 'wedding/base.html' %}

{% block content %}
<div class="container">
    {% if wedding_info %}
    <div class="welcome-message">
        <h2>Witamy na naszym weselu!</h2>
        <p>{{ wedding_info.welcome_message|default:"Cieszymy siƒô, ≈ºe mo≈ºecie byƒá z nami w tym wyjƒÖtkowym dniu. Ta aplikacja pozwoli Wam dzieliƒá siƒô wspomnieniami, przeglƒÖdaƒá zdjƒôcia i byƒá na bie≈ºƒÖco z harmonogramem uroczysto≈õci." }}</p>
        <p style="margin-top: 15px; font-style: italic;">Pamiƒôtajcie - ka≈ºde zdjƒôcie, kt√≥re prze≈õlecie, zostanie czƒô≈õciƒÖ naszej wsp√≥lnej opowie≈õci!</p>
        
        <!-- Szybkie akcje dla go≈õci -->
        <div class="quick-actions" style="margin-top: 25px; text-align: center;">
            <a href="{% url 'wedding:upload' %}" class="btn btn-custom-primary" style="margin: 5px;">
                <i class="fas fa-camera"></i> Prze≈õlij Zdjƒôcie
            </a>
            <a href="{% url 'wedding:table_finder' %}" class="btn btn-custom-primary" style="margin: 5px;">
                <i class="fas fa-chair"></i> Znajd≈∫ Sw√≥j St√≥≈Ç
            </a>
        </div>
    </div>
    {% endif %}

    {% if featured_photos %}
    <h3 class="text-center mb-4" style="color: #5d4e37;">‚≠ê Wyr√≥≈ºnione zdjƒôcia</h3>
    <div class="photo-grid">
        {% for photo in featured_photos %}
        <div class="photo-item" data-toggle="modal" data-target="#photoModal{{ photo.id }}">
            {% if photo.image %}
                {% with optimized_url=photo.get_optimized_url %}
                    {% if optimized_url %}
                        <img src="{{ optimized_url }}" alt="{{ photo.title }}" loading="lazy"
                             onerror="this.onerror=null; this.src='{{ photo.image.url }}';">
                    {% else %}
                        <img src="{{ photo.image.url }}" alt="{{ photo.title }}" loading="lazy"
                             onerror="this.onerror=null; this.src='/static/wedding/images/no-photo.jpg';">
                    {% endif %}
                {% endwith %}
            {% else %}
                <img src="/static/wedding/images/no-photo.jpg" alt="Brak zdjƒôcia" loading="lazy">
            {% endif %}
            <div class="photo-overlay">
                <h5>{{ photo.title }}</h5>
                <small>{{ photo.uploader_display_name }}</small>
            </div>
        </div>
        
        <!-- Modal dla wyr√≥≈ºnionych zdjƒôƒá -->
        <div class="modal fade" id="photoModal{{ photo.id }}" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{{ photo.title }}</h5>
                        <button type="button" class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>
                    </div>
                    <div class="modal-body text-center">
                        {% if photo.image %}
                            {% with full_url=photo.get_full_size_url optimized_url=photo.get_optimized_url %}
                                {% if full_url %}
                                    <img src="{{ full_url }}" alt="{{ photo.title }}" class="img-fluid"
                                         onerror="this.onerror=null; this.src='{% if optimized_url %}{{ optimized_url }}{% else %}{{ photo.image.url }}{% endif %}';">
                                {% elif optimized_url %}
                                    <img src="{{ optimized_url }}" alt="{{ photo.title }}" class="img-fluid"
                                         onerror="this.onerror=null; this.src='{{ photo.image.url }}';">
                                {% else %}
                                    <img src="{{ photo.image.url }}" alt="{{ photo.title }}" class="img-fluid"
                                         onerror="this.onerror=null; this.src='/static/wedding/images/no-photo.jpg';">
                                {% endif %}
                            {% endwith %}
                        {% else %}
                            <div class="text-center p-4">
                                <i class="fas fa-image fa-3x text-muted"></i>
                                <p class="mt-3 text-muted">Zdjƒôcie nie jest dostƒôpne</p>
                            </div>
                        {% endif %}
                        {% if photo.description %}
                        <p class="mt-3">{{ photo.description }}</p>
                        {% endif %}
                        <p class="text-muted">
                            Przes≈Çane przez: {{ photo.uploader_display_name }}<br>
                            {{ photo.upload_date|date:"j F Y, H:i" }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if recent_photos %}
    <h3 class="text-center mt-5 mb-4" style="color: #5d4e37;">üì∑ Najnowsze zdjƒôcia</h3>
    <div class="photo-grid">
        {% for photo in recent_photos %}
        <div class="photo-item" data-toggle="modal" data-target="#recentPhotoModal{{ photo.id }}">
            {% if photo.image %}
                {% with optimized_url=photo.get_optimized_url %}
                    {% if optimized_url %}
                        <img src="{{ optimized_url }}" alt="{{ photo.title }}" loading="lazy">
                    {% else %}
                        <img src="{{ photo.image.url }}" alt="{{ photo.title }}" loading="lazy">
                    {% endif %}
                {% endwith %}
            {% else %}
                <div class="photo-placeholder">{{ photo.title }}</div>
            {% endif %}
            <div class="photo-overlay">
                <h6>{{ photo.title }}</h6>
                <small>{{ photo.uploader_display_name }}</small>
            </div>
        </div>
        
        <!-- Modal dla najnowszych zdjƒôƒá -->
        <div class="modal fade" id="recentPhotoModal{{ photo.id }}" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{{ photo.title }}</h5>
                        <button type="button" class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>
                    </div>
                    <div class="modal-body text-center">
                        {% if photo.image %}
                            {% with full_url=photo.get_full_size_url optimized_url=photo.get_optimized_url %}
                                {% if full_url %}
                                    <img src="{{ full_url }}" alt="{{ photo.title }}" class="img-fluid"
                                         onerror="this.onerror=null; this.src='{% if optimized_url %}{{ optimized_url }}{% else %}{{ photo.image.url }}{% endif %}';">
                                {% elif optimized_url %}
                                    <img src="{{ optimized_url }}" alt="{{ photo.title }}" class="img-fluid"
                                         onerror="this.onerror=null; this.src='{{ photo.image.url }}';">
                                {% else %}
                                    <img src="{{ photo.image.url }}" alt="{{ photo.title }}" class="img-fluid"
                                         onerror="this.onerror=null; this.src='/static/wedding/images/no-photo.jpg';">
                                {% endif %}
                            {% endwith %}
                        {% else %}
                            <div class="text-center p-4">
                                <i class="fas fa-image fa-3x text-muted"></i>
                                <p class="mt-3 text-muted">Zdjƒôcie nie jest dostƒôpne</p>
                            </div>
                        {% endif %}
                        {% if photo.description %}
                        <p class="mt-3">{{ photo.description }}</p>
                        {% endif %}
                        <p class="text-muted">
                            Przes≈Çane przez: {{ photo.uploader_display_name }}<br>
                            {{ photo.upload_date|date:"j F Y, H:i" }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Link do pe≈Çnej galerii -->
    <div class="text-center mt-4">
        <a href="{% url 'wedding:gallery' %}" class="btn btn-outline-secondary">
            <i class="fas fa-images"></i> Zobacz Wszystkie Zdjƒôcia
        </a>
    </div>
    {% endif %}

    {% if not featured_photos and not recent_photos %}
    <div class="text-center mt-5">
        <div style="background: #f8f5f0; padding: 40px; border-radius: 15px; border: 1px solid #d4c4a8;">
            <h3 style="color: #7a6b5d; margin-bottom: 20px;">üì∏ Galeria czeka na Wasze zdjƒôcia!</h3>
            <p style="color: #6b5b4f; margin-bottom: 25px;">
                BƒÖd≈∫cie pierwsi! Prze≈õlij swoje najpiƒôkniejsze momenty z naszego wesela.
                Wszystkie zdjƒôcia bƒôdƒÖ widoczne dla innych go≈õci po zatwierdzeniu.
            </p>
            <a href="{% url 'wedding:upload' %}" class="btn btn-custom-primary btn-lg">
                <i class="fas fa-camera"></i> Prze≈õlij Pierwsze Zdjƒôcie
            </a>
        </div>
    </div>
    {% endif %}
    
    <!-- Informacyjna sekcja na dole -->
    <div class="info-section" style="margin-top: 50px; text-align: center;">
        <div style="background: #ede8dd; padding: 30px; border-radius: 15px; border: 1px solid #d4c4a8;">
            <h4 style="color: #5d4e37; margin-bottom: 20px;">
                <i class="fas fa-heart"></i> Zapraszamy do wsp√≥lnego tworzenia wspomnie≈Ñ!
            </h4>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <div style="color: #6b5b4f;">
                        <i class="fas fa-camera-retro" style="font-size: 2rem; color: #8b6f47; margin-bottom: 10px;"></i>
                        <h6>Przesy≈Çajcie Zdjƒôcia</h6>
                        <small>Ka≈ºdy moment jest wa≈ºny</small>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div style="color: #6b5b4f;">
                        <i class="fas fa-map-marked-alt" style="font-size: 2rem; color: #8b6f47; margin-bottom: 10px;"></i>
                        <h6>Sprawdzajcie Sto≈Çy</h6>
                        <small>Znajd≈∫cie swoje miejsca</small>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div style="color: #6b5b4f;">
                        <i class="fas fa-calendar-alt" style="font-size: 2rem; color: #8b6f47; margin-bottom: 10px;"></i>
                        <h6>≈öled≈∫cie Program</h6>
                        <small>Nie przegapcie wa≈ºnych moment√≥w</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
<div class="photo-grid" data-cols="{{ cols }}">
    {% for photo in photos %}
    <div class="photo-item" data-toggle="modal" data-target="#photoModal{{ photo.id }}">
        {% if photo.image %}
            {% with optimized_url=photo.get_optimized_url %}
                {% if optimized_url %}
                    <img src="{{ optimized_url }}" alt="{{ photo.title }}" loading="lazy"
                         onerror="this.onerror=null; this.src='{{ photo.image.url }}';">
                {% else %}
                    <img src="{{ photo.image.url }}" alt="{{ photo.title }}" loading="lazy"
                         onerror="this.onerror=null; this.src='/static/wedding/images/no-photo.jpg';">
                {% endif %}
            {% endwith %}
        {% else %}
            <div class="photo-placeholder">{{ photo.title }}</div>
        {% endif %}
        <div class="photo-overlay">
            <h6>{{ photo.title }}</h6>
            <small>{{ photo.uploader_display_name }}</small>
        </div>
    </div>
    {% endfor %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const photoGrid = document.querySelector('.photo-grid');
    const cols = photoGrid.dataset.cols || 3;
    photoGrid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
});
</script>